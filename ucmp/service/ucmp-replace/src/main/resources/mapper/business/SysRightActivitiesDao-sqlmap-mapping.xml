<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.exp.ucmp.replacement.dao.SysRightActivitiesDao" >
  
    <resultMap id="rightActivitiesResultMap" type="com.exp.ucmp.entity.SysRightActivitiesEntity">
        <id column="right_id" jdbcType="BIGINT" property="rightId" />
        <result column="right_pack_id" property="rightPackId" jdbcType="BIGINT" />
        <result column="campaign_name" property="campaignName" jdbcType="VARCHAR" />
        <result column="campaign_type" property="campaignType" jdbcType="VARCHAR" />
        <result column="campaign_describe" property="campaignDescribe" jdbcType="VARCHAR" />
        <result column="campaign_code" property="campaignCode" jdbcType="VARCHAR" />
        <result column="model_code" property="modelCode" jdbcType="VARCHAR" />
        <result column="model_name" property="modelName" jdbcType="VARCHAR" />
        <result column="shape_code" property="shapeCode" jdbcType="VARCHAR" />
        <result column="shape_name" property="shapeName" jdbcType="VARCHAR" />
        <result column="conditions" property="conditions" jdbcType="VARCHAR" />
        <result column="start_date" property="startDate" jdbcType="TIMESTAMP" />
        <result column="end_date" property="endDate" jdbcType="TIMESTAMP" />
    </resultMap>
    <select id="selectByModelAndShapeCode" resultMap="rightActivitiesResultMap">
      SELECT
        *
      FROM
        t_sys_right_activities
      WHERE
        is_enable = '01'
      AND is_delete = '00'
      AND ( model_code = #{modelCode} OR model_code = '' )
	  AND ( shape_code = #{shapeCode} OR shape_code = '' )
      AND campaign_type = #{campaignType}
      AND now() BETWEEN start_date
      AND end_date
      ORDER BY created_date DESC
    </select>
    
    <select id="getActivitiesByRightPackId" resultMap="rightActivitiesResultMap">
    SELECT
        *
      FROM
        t_sys_right_activities
      WHERE
        is_enable = '01'
      AND is_delete = '00'
      AND campaign_type = #{campaignType}
      and right_id = #{rightId}
    </select>

	<insert id="addRecordInfo" parameterType="com.exp.ucmp.grantPointsRecord.dto.GrantPointsDto">
	insert
		into
			t_sys_grant_points_record ( record_id,
			reservation_id,
			points_value,
			traceid,
			`result`,
			state_desc,
			created_by,
			created_date,
			updated_by,
			updated_date )
		values( #{recordId},
		#{reservationId},
		#{pointsValue},
		#{traceId},
		#{result},
		#{stateDesc},
		#{createdBy},
		current_timestamp,
		#{updatedBy},
		current_timestamp )
	</insert>
</mapper>