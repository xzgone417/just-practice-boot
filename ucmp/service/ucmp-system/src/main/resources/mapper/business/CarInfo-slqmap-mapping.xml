<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.exp.ucmp.car.dao.ICarInfoDao">

	<select id="getCarInfoByVin" resultType="com.exp.ucmp.car.dto.CarMainInfoDto">
		select
			tpsi.stock_id stockId,
			tpsi.product_code productCode,
			tpsi.car_series_code carSeriesCode,
			tpsi.car_series_name carSeriesName,
			tpsi.base_car_type_code baseCarTypeCode,
			tpsi.base_car_type_name baseCarTypeName,
			tpsi.vin_code vin,
			tpsi.interior_color interiorColor,
			tpsi.car_colour vehicleColor,
			tpsi.license_number license,
			tpsi.transfer_count transfersNum,
			tpsi.first_license_date licensedFirstDate,
			tpsi.license_place licensedCity,
			tpsi.manufacture_date manufactureDate,
			tpsi.invoicing_date invoiceDate,
			tpsi.stock_mileage showMileage,
			tpsi.battery_capacity batteryCapacity,
			tpsi.comprehensive_range comprehensiveRange,
			tpsi.active_time activeTime,
			tpsi.cur_active_status activeStatus,
			tpsi.new_car_price newCarPrice,
			tpsi.yearly_inspection_end_date yearlyCheckDueDate,
			tpsi.accident_insurance_end_date insuranceDueDate,
			tpsi.car_level carLevel,
			tpsi.stock_state stockState,
			tpsi.sale_price curCarPrice
		from
			t_psi_car_stock_info tpsi
		where
			tpsi.repeal_is ='00'
			and tpsi.is_delete = '00'
			<if test="carVin != null and carVin != ''">
				and tpsi.vin_code = #{carVin}
			</if>
			<if test="stockId == null">
				and tpsi.stock_state !='5106'
			</if>
			<if test="stockId != null">
				and tpsi.stock_id = #{stockId}
			</if>
	</select>
	
	<update id="updateCarInfo" parameterType="com.exp.ucmp.car.dto.CarMainInfoDto">
		update t_psi_car_stock_info 
		<trim prefix="SET" suffixOverrides="," >
		<if test="carSeriesName != null and carSeriesName !='' ">
		car_series_name=#{carSeriesName},
		</if>
		<if test="carSeriesCode != null and carSeriesCode !='' ">
		car_series_code=#{carSeriesCode},
		</if>
		<if test="baseCarTypeName != null and baseCarTypeName !='' ">
		base_car_type_name=#{baseCarTypeName},
		</if>
		<if test="baseCarTypeCode != null and baseCarTypeCode !='' ">
		base_car_type_code=#{baseCarTypeCode},
		</if>
		<if test="interiorColor != null and interiorColor !='' ">
		interior_color=#{interiorColor},
		</if>
		<if test="vehicleColor != null and vehicleColor !='' ">
		car_colour=#{vehicleColor},
		</if>
		<if test="license != null and license !='' ">
		license_number=#{license},
		</if>
		<if test="licensedFirstDate != null and licensedFirstDate !='' ">
		first_license_date=#{licensedFirstDate},
		</if>
		<if test="licensedCity != null and licensedCity !='' ">
		license_place=#{licensedCity},
		</if>
		<if test="manufactureDate != null and manufactureDate !='' ">
		manufacture_date=#{manufactureDate},
		</if>
		<if test="invoiceDate != null and invoiceDate !='' ">
		invoicing_date=#{invoiceDate},
		</if>
		<if test="showMileage != null and showMileage !='' ">
		stock_mileage=#{showMileage},
		</if>
		<if test="batteryCapacity != null and batteryCapacity !='' ">
		battery_capacity=#{batteryCapacity},
		</if>
		<if test="comprehensiveRange != null and comprehensiveRange !='' ">
		comprehensive_range=#{comprehensiveRange},
		</if>
		<if test="activeTime != null and activeTime !='' ">
		active_time=#{activeTime},
		</if>
		<if test="activeStatus != null ">
		cur_active_status=#{activeStatus},
		</if>
		<if test="newCarPrice != null ">
		new_car_price=#{newCarPrice},
		</if>
		<if test="productCode != null ">
		product_code=#{productCode},
		</if>
		</trim>
	  WHERE
     <trim prefixOverrides="AND">
         AND vin_code = #{vin}
		AND stock_state !='5106'
		AND repeal_is ='00'
     </trim>
	</update>
</mapper>