<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.exp.ucmp.permission.dao.IPermissionDao" >

  <resultMap id="resourceIdentifierResultMap" type="com.exp.ucmp.entity.ResourceIdentifierEntity" >
      <constructor>
       <idArg column="identifier_id" javaType="Long" jdbcType="BIGINT"/>
    </constructor>
    <result column="permission_id" property="permissionId" jdbcType="BIGINT" />
    <result column="identifier_name" property="identifierName" jdbcType="VARCHAR" />
    <result column="identifier_path" property="identifierPath" jdbcType="VARCHAR" />
    <result column="identifier_type" property="identifierType" jdbcType="VARCHAR" />
    <result column="access_type" property="accessType" jdbcType="VARCHAR" />
    <result column="is_valid" property="isValid" jdbcType="VARCHAR" />
    <result column="is_delete" property="isDelete" jdbcType="VARCHAR" />
    <result column="created_by" property="createdBy" jdbcType="BIGINT" />
    <result column="created_date" property="createdDate" jdbcType="TIMESTAMP" />
    <result column="updated_by" property="updatedBy" jdbcType="BIGINT" />
    <result column="updated_date" property="updatedDate" jdbcType="TIMESTAMP" />
  </resultMap>

  <sql id="t_resource_identifier_Column_List" >
    a.identifier_id,
    a.permission_id,
    a.identifier_name,
    a.identifier_path,
    a.identifier_type,
    a.access_type,
    a.is_valid,
    a.is_delete,
    a.created_by,
    a.created_date,
    a.updated_by,
    a.updated_date
  </sql>

  <select id="selectByPermissionOrUrl" parameterType="com.exp.ucmp.entity.ResourceIdentifierEntity" resultMap="resourceIdentifierResultMap">
    SELECT
    <include refid="t_resource_identifier_Column_List" />
      FROM t_resource_identifier a
      <trim prefix="WHERE" prefixOverrides="OR" >
        <if test="permissionId != null" >
          OR a.permission_id = #{permissionId, jdbcType=BIGINT}
        </if>
        <if test="identifierPath != null and identifierPath != ''" >
          OR a.identifier_path = #{identifierPath, jdbcType=VARCHAR}
        </if>
      </trim>
  </select>

  <select id="selectMenuSeqenceByParent" parameterType="com.exp.ucmp.entity.MenuInfoEntity" resultType="java.lang.Integer">
    SELECT
      max(a.menu_sequence) + 1 as menu_sequence
      FROM t_menu_info a
      <trim prefix="WHERE" prefixOverrides="OR" >
        <if test="parentMenuId != null" >
          OR a.parent_menu_id = #{parentMenuId, jdbcType=BIGINT}
        </if>
        <if test="parentMenuId == null" >
          OR a.parent_menu_id is null
        </if>
      </trim>
  </select>
</mapper>