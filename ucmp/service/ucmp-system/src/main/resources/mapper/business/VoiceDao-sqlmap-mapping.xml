<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.exp.ucmp.notice.dao.VoiceDao" >

  <!-- 查询门店所属城市 -->
  <select id="selectCityByDepartmentId" resultType="java.lang.String">
   	select city_id from t_sys_store_info tsi where tsi.org_id=#{departmentId,jdbcType=VARCHAR}
   </select>
   
  <!-- 查询门店所属城市 -->
  <select id="selectCityByPartyId" resultType="java.lang.String">
   	select
		tsi.city_id
	from
		t_sys_partner_staff_store_rela tsr ,
		t_sys_store_info tsi
	where
		tsr.store_id = tsi.store_id
		and tsr.party_id =#{partnerStaffPartyId,jdbcType=BIGINT}
  </select>
  
  <!-- 查询被叫人手机号 -->
  <select id="getCalledPhone" parameterType="com.exp.ucmp.huawei.dto.VoiceCallDto" resultType="java.lang.String">
  select
		tbi.customer_iphone
	from
		t_psi_customer_reservation_track trt,
		t_psi_customer_basic_information tbi
	where
		trt.customer_id = tbi.customer_id
		and trt.reservation_id = #{reservationId}
  </select>
  
  <insert id="addCallOutInfo" parameterType="com.exp.ucmp.huawei.dto.VoiceCallDto">
  insert
	into
		t_sys_call_out_record ( record_id,
		`timestamp`,
		session_id,
		caller,
		`called`,
		subscription_id,
		userData,
		created_by,
		created_date )
	values( #{recordId},
	#{timestamp},
	#{sessionId},
	#{caller, jdbcType=VARCHAR},
	#{called, jdbcType=VARCHAR},
	#{subscriptionId, jdbcType=VARCHAR},
	#{userData, jdbcType=VARCHAR},
	-999,
	current_timestamp )
  </insert>
  
  <select id="getStoreCalledPhone" resultType="String">
  select
		tdi.make_order_person_iphone
	from
		t_psi_car_dealer_inquiry tdi
	where
		tdi.reservation_id = #{reservationId}
  </select>
  
  <select id="countRecord" resultType="int">
  select
		count(1)
	from
		t_sys_call_out_record tcor
	where
		tcor.userData = #{userData}
  </select>
</mapper>