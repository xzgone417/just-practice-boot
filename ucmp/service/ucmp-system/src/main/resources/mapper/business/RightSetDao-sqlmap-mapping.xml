<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.exp.ucmp.rightset.dao.RightSetDao">

    <select id="selectPersonName" resultType="java.lang.String">
        select hhr_name from t_sys_organization_staff_info where rsp_user_info_id = #{partyId}
    </select>

    <select id="selectRightSetList" resultType="com.exp.ucmp.rightset.dto.RightSetPageDto">
        SELECT
            right_id as rightId,
            right_pack_id as rightPackId,
            campaign_name as campaignName,
            campaign_type as campaignType,
            campaign_describe as campaignDescribe,
            campaign_code as campaignCode,
            model_code as modelCode,
            model_name as modelName,
            shape_code as shapeCode,
            shape_name as shapeName,
            conditions,
            start_date as startDate,
            end_date as endDate,
            created_by as createdBy,
            created_person_name as createdPersonName,
            created_date as createdDate,
            is_enable as isEnable
        FROM
            t_sys_right_activities as ra
        WHERE
            is_delete != '01' and is_enable != '00'
        <if test="paramsDto.startDate != null and paramsDto.endDate != null and paramsDto.startDate != '' and paramsDto.endDate != ''">
            and ra.start_date <![CDATA[ >= ]]> date_format(#{paramsDto.startDate}, '%Y-%m-%d' )
            AND ra.end_date <![CDATA[ < ]]> DATE_ADD( date_format( #{paramsDto.endDate} , '%Y-%m-%d' ) ,INTERVAL 1 DAY)
        </if>
        <if test="paramsDto.campaignName != null and paramsDto.campaignName != ''">
            and ra.campaign_name like concat('%',#{paramsDto.campaignName},'%')
        </if>
        <if test="paramsDto.campaignType != null and paramsDto.campaignType != ''">
            <if test="paramsDto.campaignType == '3101'">
                and ra.campaign_type in ('3102','3103')
            </if>
            <if test="paramsDto.campaignType != '3101'">
                and ra.campaign_type = #{paramsDto.campaignType}
            </if>
        </if>
        <if test="paramsDto.campaignCode != null and paramsDto.campaignCode != ''">
            and ra.campaign_code = #{paramsDto.campaignCode}
        </if>
        <if test="paramsDto.flag == 1">
        AND now() BETWEEN ra.start_date AND ra.end_date
        </if>
        ORDER BY ra.created_date DESC
    </select>

</mapper>