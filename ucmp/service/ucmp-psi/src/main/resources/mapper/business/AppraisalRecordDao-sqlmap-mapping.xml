<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.exp.ucmp.carDealer.dao.AppraisalRecordDao">

    <select id="queryAppraisalRecord" resultType="com.exp.ucmp.carDealer.dto.AppraisalRecordDto">
        SELECT
			tic.brand_chinese_describe brandChineseDescribe,
			tic.car_series_chinese_describe carSeriesChineseDescribe,
			tic.car_year_chinese_describe carYearChineseDescribe,
			tic.car_type_chinese_describe carTypeChineseDescribe,
			tic.color color,
			tic.driving_mileage drivingMileage,
			tic.licensing_date licensingDate,
			tic.license_plate_num licensePlateNum,
			tic.vin_code vinCode,
			tic.transfer_times transferTimes,
			(select td.dict_value from t_sys_datadict td where td.dict_code = tic.using_nature) usingNature,
			trm.customer_expect_price customerExpectPrice,
			trm.reservation_detection_address reservationDetectionAddress,
			trm.reservation_detection_date reservationDetectionDate,
			<!-- tdi.make_order_person_id makeOrderPersonId,
			tdi.make_order_person_name makeOrderPersonName,
			tdi.make_order_person_iphone enMakeOrderPersonIphone, -->
			tdi.reservation_id reservationId,
			tar.appraisal_id appraisalId,
			tar.appraisal_date appraisalDate,
			tar.appraisal_price appraisalPrice,
			tdi.customer_name customerName,
			tdi.customer_iphone enCustomerIphone,
			tbi.clues_source cluesSource,
			tssi.created_by makeOrderPersonId,
			tssi.user_name makeOrderPersonName,
			tssi.phone_number  enMakeOrderPersonIphone,
			tssi.role_code makeOrderPersonRole,
			tsi.org_name storeName
		FROM
			t_psi_appraisal_record tar,
			t_psi_inquiry_cars tic ,
			t_psi_car_dealer_inquiry tdi,
			t_psi_customer_reservation_msg trm,
			t_psi_customer_basic_information tbi,
			t_sys_store_staff_info tssi,
			t_sys_store_info tsi
		WHERE
			tar.inquiry_id = tic.inquiry_id
			and tar.inquiry_id = tdi.inquiry_id
			and tdi.reservation_id = trm.reservation_id
			and tdi.customer_id = tbi.customer_id
			and tdi.is_delete = '01'
			and tdi.created_by = tssi.party_id
			and tdi.store_id = tssi.store_id
			and tdi.store_id = tsi.store_id
			and tar.appraisal_staff_id = #{partyId}
    </select>
    
    <select id="queryAcquisitionRecord" resultType="com.exp.ucmp.carDealer.dto.AcquisitionRecordDto">
    SELECT
		tcc.brand_chinese_describe brandChineseDescribe,
		tcc.car_series_chinese_describe carSeriesChineseDescribe,
		tcc.car_year_chinese_describe carYearChineseDescribe,
		tcc.car_type_chinese_describe carTypeChineseDescribe,
		tcc.driving_mileage drivingMileage,
		tcc.color color,
		tcc.licensing_date licensingDate,
		(select td.dict_value from t_sys_datadict td where td.dict_code = tcc.using_nature)usingNature,
		tcc.license_plate_num licensePlateNum,
		tcc.vin_code vinCode,
		tcc.transfer_times transferTimes,
		tca.reservation_id reservationId,
		tca.invoice_num invoiceNum,
		tca.deal_price_end dealPriceEnd,
		(select td.dict_value from t_sys_datadict td where td.dict_code = tca.pay_type) payType,
		trm.customer_expect_price customerExpectPrice,
		trm.reservation_detection_address reservationDetectionAddress,
		trm.reservation_detection_date reservationDetectionDate,
		tdi.car_dealer_staff_id appraisalStaffId,
		<!-- tdi.make_order_person_id makeOrderPersonId,
		tdi.make_order_person_name makeOrderPersonName,
		tdi.make_order_person_iphone enMakeOrderPersonIphone, -->
		tbi.clues_source cluesSource,
		tssi.created_by makeOrderPersonId,
		tssi.user_name makeOrderPersonName,
		tssi.phone_number  enMakeOrderPersonIphone,
		tssi.role_code makeOrderPersonRole,
		tsi.org_name storeName
	FROM
		t_psi_car_acquisition tca,
		t_psi_car_dealer_inquiry tdi,
		t_psi_customer_cars tcc ,
		t_psi_customer_reservation_msg trm,
		t_psi_customer_basic_information tbi,
		t_sys_store_staff_info tssi,
		t_sys_store_info tsi
	WHERE
		tca.reservation_id = tdi.reservation_id 
		AND tca.reservation_id = tcc.reservation_id
		AND tca.reservation_id = trm.reservation_id
		AND tdi.customer_id = tbi.customer_id
		AND tca.acquisition_status = '1102'
		AND tca.approval_status not in ('1305','1309')
		and tdi.created_by = tssi.party_id
		and tdi.store_id = tssi.store_id
		and tdi.store_id = tsi.store_id
		AND tdi.car_dealer_staff_id = #{partyId}
    </select>
    
    <select id="queryAcquisitionMaterial" resultType="com.exp.ucmp.carDealer.dto.AcquisitionMaterialDto">
    	SELECT
			tam.reservation_id reservationId,
			tmf.material_file_id materialFileId,
			tmf.material_id materialId,
			(select td.dict_value from t_sys_datadict td where td.dict_code = tam.material_type)  materialType,
			tmf.material_order materialOrder,
			tmf.thumbnail thumbnail,
			tfm.file_name fileName,
			tfm.file_path filePath,
			tfm.file_type fileType,
			tfm.file_statuss  fileStatuss
		FROM
			t_psi_acquisition_material tam,
			t_psi_acquisition_material_file tmf,
			t_sys_file_msg tfm 
		WHERE
			tam.material_id = tmf.material_id 
			AND tmf.material_file_id = tfm.file_id 
			AND tfm.file_statuss = '2101'
			AND tam.reservation_id = #{reservationId}
    </select>
</mapper>