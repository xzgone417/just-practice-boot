<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.exp.ucmp.storeApp.dao.ExpenseListDao">

    <select id="queryExpenseList" resultType="com.exp.ucmp.stock.dto.ExpenseListDto">
        <!--
        原sql，问题1：final_sales_price字段表中缺失，问题2：t_psi_order_info可能会有多个订单
        SELECT
        a.storage_name storageName,
        (select dict_value from t_sys_datadict  where dict_code = a.car_source) carSource,
        (select dict_value from t_sys_datadict  where dict_code = a.stock_type) stockType,
        (select dict_value from t_sys_datadict  where dict_code = a.decision_type) decisionType,
        a.source_batch sourceBatch,
        (select dict_value from t_sys_datadict  where dict_code = a.revert_body) revertBody,
        a.vin_code vin,
        a.car_series_name carSeriesName,
        a.base_car_type_name baseCarTypeName,
        a.car_colour carColour,
        a.stock_id stockId,
        a.warehous_date warehousDate,
        a.deliver_date deliverDate,
        a.purchase_price purchasePrice,
        b.total_price totalPrice,
        d.final_sales_price finalSalesPrice,
        e.wholesale_price wholesalePrice,
        f.facial_cost facialCost,
        f.logistics_cost logisticsCost,
        f.test_cost testCost,
        f.retain_cost retainCost,
        f.friendly_cost friendlyCost,
        f.right_cost rightCost,
        f.interest_cost interestCost,
        f.gift_cost giftCost,
        f.brokerage_cost brokerageCost,
        f.other_cost otherCost
        FROM
        t_psi_car_stock_info a
        left JOIN t_psi_car_service_info b on a.stock_id = b.stock_id
        left join t_psi_order_info d on a.vin_code = d.car_vin
        left join t_psi_car_sale_record e on a.stock_id = e.stock_id
        left join t_psi_car_cost_info f on a.stock_id = f.stock_id
        where  a.vin_code =#{vin}
        -->

        SELECT
            a.storage_name AS storageName,
            ( SELECT dict_value FROM t_sys_datadict WHERE dict_code = a.car_source ) AS carSource,
            ( SELECT dict_value FROM t_sys_datadict WHERE dict_code = a.stock_type ) AS stockType,
            ( SELECT dict_value FROM t_sys_datadict WHERE dict_code = a.decision_type ) AS decisionType,
            a.source_batch AS sourceBatch,
            ( SELECT dict_value FROM t_sys_datadict WHERE dict_code = a.revert_body ) AS revertBody,
            a.vin_code AS vin,
            a.car_series_name AS carSeriesName,
            a.base_car_type_name AS baseCarTypeName,
            a.car_colour AS carColour,
            a.stock_id AS stockId,
            a.warehous_date AS warehousDate,
            a.deliver_date AS deliverDate,
            a.purchase_price AS purchasePrice,
            f.facial_cost AS facialCost,
            f.logistics_cost AS logisticsCost,
            f.test_cost AS testCost,
            f.retain_cost AS retainCost,
            f.friendly_cost AS friendlyCost,
            f.right_cost AS rightCost,
            f.interest_cost AS interestCost,
            f.gift_cost AS giftCost,
            f.brokerage_cost AS brokerageCost,
            f.other_cost AS otherCost,
            f.cost_info_id AS costInfoId,
            f.checkout_date AS checkoutDate,
            f.income_price AS incomePrice,
            f.service_cost AS serviceCost,
            f.sell_price AS sellPrice
        FROM
            t_psi_car_stock_info AS a
                LEFT JOIN t_psi_car_cost_info AS f ON a.stock_id = f.stock_id
        WHERE
            a.is_delete = '00'
          AND a.is_enable = '01'
          and a.stock_state != '5106'
          AND a.vin_code =#{vin}
    </select>

</mapper>